!function(root,factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):root.Ulala=factory(root.jQuery)}(this,function($){var Ulala={$document:$(document),$window:$(window),cssPrefix:function(){var styles=window.getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1];"WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1];return"-"+pre+"-"}(),domPrefix:"data-ulala-",$elements:null,suffix:"",config:{preloadIn:1,visibilityIn:0,useSuffixes:!0,loadedClass:"-loaded",visibleClass:"-visible"}};return Ulala.attr=function($this,prop,newValue){return null!=newValue?$this.attr(Ulala.domPrefix+""+prop,newValue):$this.attr(Ulala.domPrefix+""+prop)},Ulala.calcImageSuffix=function(){window.innerWidth>=768?(window.devicePixelRatio||1)>1?Ulala.suffix="-desktop@2x":Ulala.suffix="-desktop":(window.devicePixelRatio||1)>2?Ulala.suffix="-mobile@3x":Ulala.suffix="-mobile@2x"},Ulala._shouldBeWaitLoading=function($this){return null!=$this.data("image")||"IMG"===$this.prop("tagName")},Ulala.elementLoadImage=function($this){var onLoaded=function(){Ulala.attr($this,"loaded",!0),$this.addClass(Ulala.config.loadedClass),Ulala.attr($this,"visible")&&Ulala.elementShowImage($this)};if($this.prop("complete")?onLoaded():$this.load(onLoaded),null!=$this.data("image")){var file=$this.data("image");Ulala.config.useSuffixes&&null==$this.data("nosuffix")&&(file=file.replace(/(\..+$)/,function(match,$1,$2,offset,original){return Ulala.suffix+$1})),new Image(file).addEventListener("load",function(){"IMG"===$this.prop("tagName")?$this.attr("src",file):$this.attr("style",'background-image: url("'+file+'")')},!1)}},Ulala.elementShowImage=function($this){Ulala.attr($this,"visible",!0),Ulala.attr($this,"loaded")&&$this.addClass(Ulala.config.visibleClass)},Ulala.elementParallax=function($this,cs,wh){var $wrapper=$this.parent(),offset=Ulala.attr($this,"otop")<<0,height=$wrapper.outerHeight()<<0,translation=cs/(offset+height),cssTranslation=-1*Math.min(Math.max(translation,0),1)*(Ulala.attr($this,"pdelta")<<0);$this.css(Ulala.cssPrefix+"transform","translate3d(0, "+cssTranslation+"px, 0)")},Ulala.parse=function(e){var cs=Ulala.$document.scrollTop(),wh=Ulala.$window.height(),offsets={loading:cs+wh+wh*Ulala.config.preloadIn,waypoint:cs+wh+wh*Ulala.config.visibilityIn};Ulala.$elements.each(function(){var $this=$(this),offset=Ulala.attr($this,"otop");Ulala._shouldBeWaitLoading($this)?!Ulala.attr($this,"loading")&&offset<offsets.loading&&(Ulala.attr($this,"loading",!0),Ulala.elementLoadImage($this,cs,wh)):Ulala.attr($this,"loaded",!0),null!=$this.attr("data-waypoint")&&!Ulala.attr($this,"waypointing")&&offset<offsets.waypoint&&(Ulala.attr($this,"waypointing",!0),Ulala.elementShowImage($this,cs,wh)),null!=$this.attr("data-parallax")&&Ulala.elementParallax($this,cs,wh)})},Ulala.elementParseParallax=function($this){var $wrapper=$this.parent(),r=1+Number($this.attr("data-parallax")||.25),wrapperHeightWithPR=r*$wrapper.outerHeight(),onLoaded=function(){var RI=$this.prop("naturalWidth")/$this.prop("naturalHeight"),RW=$wrapper.outerWidth()/wrapperHeightWithPR;RI>RW?($this.height(wrapperHeightWithPR),$this.width(wrapperHeightWithPR*RI)):($this.width($wrapper.outerWidth()),$this.height($wrapper.outerWidth()/RI));var delta=$this.height()-$wrapper.outerHeight();Ulala.attr($this,"pdelta",delta),$this.css({left:"-999px",right:"-999px",top:0,margin:"0 auto"})};$this.prop("complete")?onLoaded():$this.load(onLoaded)},Ulala.preParse=function(){Ulala.PARSING_TIME=Date.now(),Ulala.calcImageSuffix(),Ulala.$elements.each(function(){var $this=$(this);Ulala.attr($this,"otop",$this.offset().top),null!=$this.attr("data-parallax")&&(Ulala.attr($this,"otop",$this.parent().offset().top),Ulala.attr($this,"parallax-parsed")<<0<Ulala.PARSING_TIME&&(Ulala.attr($this,"parallax-parsed",Ulala.PARSING_TIME),Ulala.elementParseParallax($this)))})},Ulala.run=function(){Ulala.preParse(),requestAnimationFrame(Ulala.parse)},Ulala.init=function(config){$.extend(Ulala.config,config||{}),Ulala.PARSING_TIME=Date.now();var style="";style+="[data-parallax-wrapper] { overflow: hidden; position: relative; }",style+="[data-parallax] { position: absolute; }",$("head").append("<style>"+style+"</style>"),Ulala.$elements=$("[data-waypoint], [data-image], [data-parallax]"),null==Ulala._handlerAttached&&(Ulala._handlerAttached=!0,Ulala.$window.on("resize",Ulala.run),Ulala.$document.on("scroll",Ulala.run)),Ulala.$window.load(Ulala.run),Ulala.run()},Ulala});